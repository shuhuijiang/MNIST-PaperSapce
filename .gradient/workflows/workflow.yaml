on:
  github:
    branches:
      only: main

jobs:
  CloneRepo:
    resources:
      instance-type: C4
    uses: git-checkout@v1
    with:
      # url: https://github.com/gradient-ai/mnist-sample.git
      url: context.event.github.url
      #ref: context.event.github.ref
    outputs:
      repo:
        type: volume
  TrainModel:
    resources:
      instance-type: C4
    env:
      PS_MODEL_PATH: /my-trained-model
    uses: container@v1
    with:
      args:
        - bash
        - -c
        - >-
          cd /inputs/repo && python mnist.py
      image: tensorflow/tensorflow:1.15.5-py3
    needs:
      - CloneRepo
    inputs:
      repo: CloneRepo.outputs.repo
# test git config only selected repo


# on:
#   github:
#     branches:
#       only: main
# jobs:
#   CloneRepo:
#     resources:
#       instance-type: C5
#     outputs:
#       repo:
#         type: volume
#     uses: git-checkout@v1
#     with:
#       url: context.event.github.url
#   HelloWorld:
#     resources:
#       instance-type: C5
#     needs:
#       - CloneRepo
#     inputs:
#       repo: CloneRepo.outputs.repo
#     uses: script@v1
#     with:
#       script: python /inputs/repo/hello.py
#       image: tensorflow/tensorflow:1.14.0-py3



